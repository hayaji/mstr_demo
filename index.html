<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>MicroStrategy Embedded Dossier</title>
    <script type="text/javascript" src="https://report.diasteknoloji.com/MicroStrategyLibrary/javascript/embeddinglib.js"></script>
  </head>
  <body>
    <div>This is an example of a page with a single embedded dossier.</div>
    <div id="mydossier"></div>

    <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", async function () {
        // 1Ô∏è‚É£ Login API √ßaƒürƒ±sƒ± yap ve token al
      async function login() {
    try {
        const response = await fetch("https://report.diasteknoloji.com/MicroStrategyLibrary/api/auth/login", {
            method: "POST",
            headers: {
                "accept": "application/json",
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                username: "portaldbys.user",
                password: "Aa123456",
                loginMode: 1
            })
        });

        // üõ† Token header i√ßinde mi? Kontrol et
        const authToken = response.headers.get("x-mstr-authtoken");

        if (!authToken) throw new Error("Login failed: No auth token received!");

        console.log("‚úÖ Login successful, token:", authToken);
        return authToken;
    } catch (error) {
        console.error("‚ùå Login error:", error);
        alert("Login failed! Check the console for details.");
        return null;
    }
}

        // 2Ô∏è‚É£ Token al ve Dossier'ƒ± embed et
        const authToken = await login();
        if (!authToken) return; // Login ba≈üarƒ±sƒ±zsa devam etme

        var container = document.getElementById("mydossier");
        var url = "https://report.diasteknoloji.com/MicroStrategyLibrary/app/B1AE84B54741CE143087C3B900E29D47/FD3757D7439EC2DC7E1A3692AC22CF89";

        microstrategy.dossier.create({
          url: url,
          enableResponsive: true,
          placeholder: container,
          containerHeight: "1000px",
          enableCollaboration: false,
          params: { mstrAuthToken: authToken }, // üîπ Token burada kullanƒ±lƒ±yor
          dockedTOC: {
            dockedPosition: "left",
            theme: "light",
            canClose: false,
            dockChangeable: false,
            isDocked: false
          },
          navigationBar: {
            enabled: false,
            gotoLibrary: false,
            title: false,
            toc: false,
            reset: false,
            share: false,
            comment: false,
            filter: false
          },
          optionsFeature: {
            enabled: false,
            help: true,
            manage: true,
            logout: true,
            showTutorials: true
          },
          filterFeature: {
            enabled: false,
            editable: false,
            summary: true
          },
          shareFeature: {
            enabled: false,
            invite: false,
            link: false,
            email: false,
            export: false,
            download: false
          }
        });
      });
    </script>
  </body>
</html>
